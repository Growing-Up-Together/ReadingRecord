# 14. ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨

- MySQL ì—ì„œëŠ” ì ˆì°¨ì ì¸ ì²˜ë¦¬ë¥¼ ìœ„í•´ ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ ì´ìš©ê°€ëŠ¥
- ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì€ ìŠ¤í† ì–´ë“œ ë£¨í‹´ì´ë¼ê³  ë¶ˆë¦¼
`ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨` = `ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €` + `ìŠ¤í† ì–´ë“œ í•¨ìˆ˜` + `íŠ¸ë¦¬ê±°` + `ì´ë²¤íŠ¸` ë“±ì„ ëª¨ë‘ ì•„ìš°ë¥´ëŠ” ëª…ì¹­

## 14.1 ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì¥ë‹¨ì 

### 14.1.1 ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì¥ì 

- ë°ì´í„°ë² ì´ìŠ¤ì˜ ë³´ì•ˆ í–¥ìƒ
- ê¸°ëŠ¥ì˜ ì¶”ìƒí™”
- ë„¤íŠ¸ì›Œí¬ ì†Œìš” ì‹œê°„ ì ˆê°
- ì ˆì°¨ì  ê¸°ëŠ¥ êµ¬í˜„
- ê°œë°œ ì—…ë¬´ì˜ êµ¬ë¶„

### 14.1.2 ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ë‹¨ì 

- ë‚®ì€ ì²˜ë¦¬ ì„±ëŠ¥: í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì‹œë§ˆë‹¤ ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì½”ë“œê°€ íŒŒì‹±ë˜ì–´ì•¼ í•¨
- ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì˜ ì¡°ê°í™”

## 14.2 ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ë¬¸ë²•

`ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨` = `í—¤ë” ë¶€ë¶„` + `ë³¸ë¬¸ ë¶€ë¶„`
     í—¤ë” ë¶€ë¶„: ì •ì˜ë¶€, ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì´ë¦„ê³¼ ì…ì¶œë ¥ ê°’ì„ ëª…ì‹œí•˜ëŠ” ë¶€ë¶„
     ë³¸ë¬¸ ë¶€ë¶„: ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ë°”ë””, ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì´ í˜¸ì¶œëì„ ë•Œ ì‹¤í–‰í•˜ëŠ” ë‚´ìš©ì„ ì‘ì„±í•˜ëŠ” ë¶€ë¶„

### 14.2.2 ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €

ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ëŠ” ì„œë¡œ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ì•„ì•¼ í•˜ëŠ” ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ì˜ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì–´ì„œ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ì‚¬ìš©

**14.2.2.1 ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì € ìƒì„± ë° ì‚­ì œ**

**ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì € ìƒì„±**

- ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ëŠ” `CREATE PROCEDURE` ëª…ë ¹ìœ¼ë¡œ ìƒì„±
    
    ```sql
    mysql> 
     CREATE PROCEDURE sp_num(IN param1 INTEGER, IN param2 INTEGER, OUT param3 INTEGER)
        BEGIN
          SET param3 = param1 + param2;
         END;; 
    ```
    
    - í”„ë¡œìŠ¤ì € ì´ë¦„ `sp_num`
    - param1, param2, param3 íŒŒë¼ë¯¸í„° í•„ìš”.
    - BEGIN ~ END ê¹Œì§€ ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ì˜ ë³¸ë¬¸
- ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ëŠ” ê¸°ë³¸ ë°˜í™˜ì´ ì—†ìŒ. ì¦‰, `RETURN ëª…ë ¹ ì‚¬ìš© ë¶ˆê°€`
- `IN` íƒ€ì…ìœ¼ë¡œ ì •ì˜ëœ íŒŒë¼ë¯¸í„°  = ì…ë ¥ ì „ìš© íŒŒë¼ë¯¸í„°
- `OUT` íƒ€ì…ìœ¼ë¡œ ì •ì˜ëœ íŒŒë¼ë¯¸í„° = ì¶œë ¥ ì „ìš© íŒŒë¼ë¯¸í„°
- `INOUT` íƒ€ì…ìœ¼ë¡œ ì •ì˜ëœ íŒŒë¼ë¯¸í„° = ì…ë ¥ ë° ì¶œë ¥ ìš©ë„ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥

<aside>
ğŸ’¡ DELIMITER?
ëª…ë ¹ì˜ ëì„ ì•Œë ¤ì£¼ëŠ” ì¢…ë£Œ ë¬¸ìë¥¼ ë³€ê²½í•˜ëŠ” ëª…ë ¹ì–´

â€” ì¢…ë£Œ ë¬¸ìë¥¼ [;;] ë¡œ ë³€ê²½
mysql> DELIMITER ;;

</aside>

**ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì € ë³€ê²½ ë° ì‚­ì œ**

- ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì € ë³€ê²½ ì‹œ `ALTER PROCEDURE` ëª…ë ¹ì–´ ì‚¬ìš©
- ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì € ì‚­ì œ ì‹œ `DROP PROCEDURE` ëª…ë ¹ì–´ ì‚¬ìš©
- ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ì˜ íŒŒë¼ë¯¸í„°ë‚˜ ì²˜ë¦¬ ë‚´ìš© ë³€ê²½ ì‹œ, `DROP PROCEDURE` ì‹¤í–‰í•˜ì—¬ ê¸°ì¡´ í”„ë¡œì‹œì € ì‚­ì œ í›„ `CREATE PROCEDURE` ì‹¤í–‰í•˜ì—¬ í”„ë¡œì‹œì € ìƒˆë¡œ ìƒì„±í•˜ëŠ” ê²ƒì´ ìœ ì¼í•œ ë°©ë²•

```sql
mysql> ALTER PROCEDURE sp_num. SQL SECURITY DEFINER;

-- íŒŒë¼ë¯¸í„° ë³€ê²½ ì‹œ 
mysql> DROP PROCEDURE sp_num;
mysql> CREATE PROCEDURE sp_num(IN param1 INTEGER, IN param2 INTEGER, OUT param3 INTEGER)
         BEGIN
           SET param3 = param1 + param2
          END;; 
```

**14.2.2.2 ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì € ì‹¤í–‰**

ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ì™€ ìŠ¤í† ì–´ë“œ í•¨ìˆ˜ì˜ ì°¨ì´ì ì€ `í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ëŠ” ë°©ë²•`ì„. 

- ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ëŠ” `SELECT ì¿¼ë¦¬ ì‚¬ìš© ë¶ˆê°€`. 
â†’ `CALL ëª…ë ¹ì–´ë¡œ ì‹¤í–‰`
- í”„ë¡œì‹œì € ì‹¤í–‰ ì™„ë£Œ í›„ ì–´ë–¤ ê°’ë„ ìë™ìœ¼ë¡œ í‘œì‹œë˜ì§€ ì•ŠìŒ
â†’ í”„ë¡œì‹œì € ì‹¤í–‰ ê²°ê³¼ í™•ì¸ì„ ìœ„í•´ì„œëŠ” OUT íŒŒë¼ë¯¸í„°ë¥¼ ì„¸ì…˜ë³€ìˆ˜ì— ë°›ì•„ ì¡°íšŒí•´ì•¼ í•¨
    
    ```sql
    mysql> SET @result:=0;
    mysql> SELECT @result; -- ê²°ê³¼ 0
    
    mysql> CALL sp_num(1,2,@result);
    mysql> SELECT @result; -- ê²°ê³¼ 3
    ```
    

**14.2.2.3 ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ì˜ ì»¤ì„œ ë°˜í™˜**

â€¦

### 14.2.6 ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ ë³¸ë¬¸(Body) ì‘ì„±

**14.2.6.1 BEGIN â€¦ END ë¸”ë¡ê³¼ íŠ¸ëœì­ì…˜**

- ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ë³¸ë¬¸ì€ `BEGIN ... END`ë¸”ë¡ìœ¼ë¡œ ì •ì˜í•˜ë©°, ì—¬ëŸ¬ê°œì˜ ë¸”ë¡ì„ ì¤‘ì²©í•´ì„œ í¬í•¨ ê°€ëŠ¥
- `BEGIN ... END` ë¸”ë¡ ë‚´ì—ì„œ ì£¼ì˜í•  ê²ƒì€ `íŠ¸ëœì­ì…˜ ì²˜ë¦¬`
    - MySQLì—ì„œ íŠ¸ëœì­ì…˜ ì‹œì‘ ëª…ë ¹ì€ `START TRANSACTION`, BEGIN
    â†’ `BEGIN` ëª…ë ¹ì€ `BEGIN ... END` ë¸”ë¡ì˜ begin ìœ¼ë¡œ í•´ì„
    - íŠ¸ëœì­ì…˜ ì¢…ë£Œ ì‹œ `COMMIT`, `ROLLBACK` ëª…ë ¹ ì‚¬ìš©
    - `ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €`ë‚˜ `ì´ë²¤íŠ¸`ì˜ ë³¸ë¬¸ì—ì„œë§Œ `íŠ¸ë™ì­ì…˜ ì‚¬ìš© ê°€ëŠ¥`
    â†’ ìŠ¤í† ì–´ë“œ í•¨ìˆ˜, íŠ¸ë¦¬ê±°ì—ì„œ íŠ¸ëœì­ì…˜ ì‚¬ìš© ë¶ˆê°€
    
    ```sql
    -- transaction ì„ í”„ë¡œì‹œì €ì—ì„œ ì‹¤í–‰
    mysql> create procedure sp_hello (in name varchar(50))
         begin
         start transaction;
            insert into tb_hello values (name, concat('Hello ', name));
         commit;
         end ;;
    
    -- taransaction ì„ ì¿¼ë¦¬ì—ì„œ ì‹¤í–‰
    mysql> create procedure sp_hello (in name varchar(50))
         begin
            insert into tb_hello values (name, concat('Hello ', name));
         end ;;
    
    mysql> start transaction;
    mysql> call sp_hello('First');
    mysql> commit;
    mysql> select * from tb_hello;
    
    mysql> start transaction;
    mysql> call sp_hello('Second');
    mysql> rollback;
    mysql> select * from tb_hello;
    -----+-----------+
    name |concat_name|
    -----+-----------+
    First|Hello First|
    ```
    

**14.2.6.2 ë³€ìˆ˜**

- ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ BEGIN â€¦ END ë¸”ë¡ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë³€ìˆ˜ëŠ” `ë¡œì»¬ë³€ìˆ˜`, `ìŠ¤í† ì–´ë“œ ë¡œí”„ë¡œê·¸ë¨ ë¡œì»¬ ë³€ìˆ˜` ë¡œ ëª…ëª…. ì‚¬ìš©ì ë³€ìˆ˜ì™€ëŠ” ë‹¤ë¦„
- `ë¡œì»¬ ë³€ìˆ˜` ëŠ”
    - `declare` ëª…ë ¹ìœ¼ë¡œ ì •ì˜ë˜ê³  ë°˜ë“œì‹œ `íƒ€ì…` ì´ í•¨ê»˜ ëª…ì‹œ ë˜ì•¼ í•¨
    â†’ ë°˜ë“œì‹œ íƒ€ì…ê³¼ ì •ì˜ë˜ë¯€ë¡œ ì»´íŒŒì¼ëŸ¬ ìˆ˜ì¤€ì—ì„œ íƒ€ì… ì˜¤ë¥˜ ì²´í¬ ê°€ëŠ¥
    - `set` ëª…ë ¹ ë˜ëŠ” `select ... into ...` ë¬¸ì¥ìœ¼ë¡œ ê°€ëŠ¥
    - ì‚¬ìš©ì‚¬ ë³€ìˆ˜ë³´ë‹¤ ë¹ ë¥´ë©° ë‹¤ë¥¸ ì¿¼ë¦¬ë‚˜ ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ê³¼ì˜ ê°„ì„­ ë°œìƒ x
    
    ```sql
    // begin ... end ë¸”ë¡ ë²”ìœ„ ë‚´
    
    // ë¡œì»¬ ë³€ìˆ˜ ì •ì˜
    //     delcare ëª…ë ¹ìœ¼ë¡œ ì •ì˜í•˜ë©° íƒ€ì…ì„ ë°˜ë“œì‹œ ì§€ì •
    //     default ê°’ ì •ì˜ ê°€ëŠ¥. ë¯¸ì§€ì • ì‹œ null
    declare v_name varchar(50) default 'Matt';
    declare v_email varchar(50) default 'matt@email.com';
    
    // ë¡œì»¨ ë³€ìˆ˜ì— ê°’ í• ë‹¹
    set v_name = 'Kim', v_email='kim@email.com';
    
    // select ... into êµ¬ë¬¸ì„ ì´ìš©í•œ ê°’ì˜ í• ë‹¹
    //     select ëª…ë ¹ì€ ë°˜ë“œì‹œ 1ê°œì˜ ë ˆì½”ë“œë¥¼ ë°˜í™˜í•˜ëŠ” sql 
    select emp_no, first_name, last_name into v_empno, v_firstname, v_lastname
    from employees
    where emp_no = 10001
    limit;
    ```
    
- ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ begin â€¦ end ë¸”ë¡ì—ì„œëŠ” ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì…ë ¥ íŒŒë¼ë¯¸í„°, declare ë¡œ ìƒì„±ëœ ë¡œì»¬ ë³€ìˆ˜, í…Œì´ë¸”ì˜ ì¹¼ëŸ¼ëª… ëª¨ë‘ ê°™ì€ ì´ë¦„ ì§€ì • ê°€ëŠ¥í•˜ë©° ì•„ë˜ì™€ ê°™ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§
â†’ êµ¬ë¶„ì„ ìœ„í•´ ë³€ìˆ˜ëª…ì— prefix ì‚¬ìš© ì¶”ì²œ
    - declare ë¡œ ì§€ì •í•œ ë¡œì»¬ ë³€ìˆ˜
    - ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì…ë ¥ íŒŒë¼ë¯¸í„°
    - í…Œì´ë¸”ì˜ ì¹¼ëŸ¼
- ì¤‘ì²©ëœ begin .. end ë¸”ë¡ì— ê°ê° ë˜‘ê°™ì€ ì´ë¦„ì˜ ë¡œì»¬ ë³€ìˆ˜ ì •ì˜ ê°€ëŠ¥
    - ì™¸ë¶€ ë¸”ë¡ì—ì„œ ë‚´ë¶€ ë¸”ë¡ ì •ì˜ëœ ë¡œì»¬ ë³€ìˆ˜ ì°¸ì¡° ë¶ˆê°€
    - ë‚´ë¶€ ë¸”ë¡ì—ì„œ ì™¸ë¶€ ë¸”ë¡ ë¡œì»¬ ë³€ìˆ˜ ì°¸ì¡° ê°€ëŠ¥
    â†’ ê°€ì¥ ê°€ê¹Œìš´ ì™¸ë¶€ ë¸”ë¡ì— ì •ì˜ëœ ë¡œì»¬ ë³€ìˆ˜ ì°¸ì¡°
    

### 14.2.6.3 ì œì–´ë¬¸

ìŠ¤í† ì–´ë“œ í”„ê·¸ë¨ì˜ begin â€¦end ë¸”ë¡ë¬¸ ë‚´ì—ì„œë§Œ ì œì–´ë¬¸ ì‚¬ìš© ê°€ëŠ¥

14.2.6.3.1 IF â€¦ ELSEIF â€¦ ELSE â€¦ END IF

if ë¬¸ì¥ì€ `end if` í‚¤ì›Œë“œë¡œ if ë¸”ë¡ì„ ì¢…ë£Œí•´ì•¼ í•¨

```sql
mysql> create function sf_greatest(p_value1 int, p_value2 int)
returns int
begin
	if p_value1 is null then
	  return p_value2;
	elseif p_value2 is null then
	  return p_value1;
	elseif p_value1 >= p_value2 then
	  return p_value1;
	else
	  return p_value2;
	end if;
end;;

mysql> select sf_greatest(1, null);
--------------------+-----+
Name                |Value|
--------------------+-----+
sf_greatest(1, null)|1    |
```

**14.2.6.3.2 CASE WHEN â€¦ THEN â€¦ ELSE â€¦ END CASE**

`case` ë¡œ ì‹œì‘í•˜ì—¬ `end case` ë¡œ ì¢…ë£Œ. break êµ¬ë¬¸ì€ í•„ìš” ì—†ìŒ

```sql
// case when ... then ... else ... end case êµ¬ë¬¸ ì‚¬ìš©
create function sf_greatest1(p_value1 int, p_value2 int)
returns int
begin
	case 
		when p_value1 is null then
	  		return p_value2;
		when p_value2 is null then
	  		return p_value1;
		when p_value1 >= p_value2 then
	  		return p_value1;
	  	else 
	  		return p_value2;
	end case;
end;;
```

**14.2.6.3.3 ë°˜ë³µë£¨í”„**

ë°˜ë³µ ë£¨í”„ ì²˜ë¦¬ëŠ” `loop`, `repeat`, `while` êµ¬ë¬¸ ì‚¬ìš© ê°€ëŠ¥

- `loop` ë¬¸ì€ ë³„ë„ì˜ ë°˜ë³µ ì¡°ê±´ ëª…ì‹œ ë¶ˆê°€
    - ë°˜ë³µ ë¹„êµ ì¡°ê±´ì´ ì—†ê³  ë¬´í•œ ë£¨í”„ ì‹¤í–‰ì— ì£¼ì˜
    - `leave` ëª…ë ¹ì–´ ì‚¬ìš©í•˜ì—¬ ë°˜ë³µ êµ¬ë¶„ íƒˆì¶œ
    
    ```sql
    create function sf_factorial1 (p_max int)  
    	returns int
    begin
    	declare v_factorial int default 1;
    
    	**factorial_loop : loop**
    		set v_factorial = v_factorial * p_max;
    		set p_max = p_max - 1;
    	
    		if p_max<=1 then
    			**leave factorial_loop;**
    		end if;	
    	**end loop;**
    
    	return v_factorial;
    end;;
    	
    mysql> select sf_factorial1(3);
    ----------------+-----+
    Name            |Value|
    ----------------+-----+
    sf_factorial1(3)|6    |
    ```
    
- `repeat` ë³„ë„ì˜ ë°˜ë³µ ì¡°ê±´ ëª…ì‹œ ê°€ëŠ¥
    - ë³¸ë¬¸ì„ ë¨¼ì € ì²˜ë¦¬í•˜ê³  ë°˜ë³µ ì¡°ê±´ ì²´í¬
    
    ```sql
    create function sf_factorial2 (p_max int)  
    	returns int
    begin
    	declare v_factorial int default 1;
    
    	**repeat**
    		set v_factorial = v_factorial * p_max;
    		set p_max = p_max - 1;
    	
    		until p_max <= 1 **end repeat;**
    
    	return v_factorial;
    end;;
    
    mysql> select sf_factorial1(3);
    ----------------+-----+
    Name            |Value|
    ----------------+-----+
    sf_factorial2(3)|6    |
    ```
    
- `while` ë³„ë„ì˜ ë°˜ë³µ ì¡°ê±´ ëª…ì‹œ ê°€ëŠ¥
    - ë°˜ë³µ ì¡°ê±´ ì²´í¬ í›„ ë³¸ë¬¸ ì‹¤í–‰
    
    ```sql
    create function sf_factorial3 (p_max int)  
    	returns int
    begin
    	declare v_factorial int default 1;
    
    	**while** p_max>1 **do**
    		set v_factorial = v_factorial * p_max;
    		set p_max = p_max - 1;
    	**end while;**
    
    	return v_factorial;
    end;;
    
    mysql> select sf_factorial3(3);
    ----------------+-----+
    Name            |Value|
    ----------------+-----+
    sf_factorial3(3)|6    |
    ```
    

### 14.2.6.4 í•¸ë“¤ëŸ¬ì™€ ì»¨ë””ì…˜ì„ ì´ìš©í•œ ì—ëŸ¬ í•¸ë“¤ë§

ì•ˆì •ì ì´ê³  ê²¬ê³ í•œ ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•˜ë ¤ë©´ ë°˜ë“œì‹œ í•¸ë“œëŸ¬ë¥¼ ì´ìš©í•´ ì˜ˆì™¸ ì²˜ë¦¬ í•„ìš”

- í•¸ë“¤ëŸ¬: ì´ë¯¸ ì •ì˜í•œ ì»¨ë””ì…˜ ë˜ëŠ” ì‚¬ìš©ìê°€ ì •ì˜í•œ ì»¨ë””ì…˜ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ ì •ì˜í•˜ëŠ” ê¸°ëŠ¥
- ì»¨ë””ì…˜: sql ë¬¸ì¥ì˜ ì²˜ë¦¬ ìƒíƒœì— ëŒ€í•´ ë³„ëª…ì„ ë¶™ì´ëŠ” ê²ƒê³¼ ê°™ì€ ì—­í• . ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ê°€ë…ì„±ì„ ë†’ì´ëŠ” ìš”ì†Œë¡œ í•„ìˆ˜ ê°’ì€ ì•„ë‹˜

**14.2.6.4.1 SQLSTATE ì™€ ì—ëŸ¬ ë²ˆí˜¸(Error No)**

```sql
mysql> select * from not_found_table;
SQL Error [1146] [42S02]: Table 'test.not_found_table' doesn't exist
```

- MySQL í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì¿¼ë¦¬ ì‹¤í–‰ ì‹œ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²½ìš° `ERROR ERROR-NO(SQL-STATE) : ERROR-MESSAGE` í˜•íƒœë¡œ ë©”ì‹œì§€ ì¶œë ¥
    - ERROR : 4ìë¦¬ ìˆ«ì ê°’ìœ¼ë¡œ êµ¬ì„±. MySQL ì—ì„œë§Œ ìœ íš¨í•œ ì—ëŸ¬ ì‹ë³„ ë²ˆí˜¸
    - SQL-STATE : ë‹¤ì„¯ ê¸€ìì˜ ì•ŒíŒŒë²³ê³¼ ìˆ«ìë¡œ êµ¬ì„±. ANSI SQL í‘œì¤€ì„ ì¤€ìˆ˜í•˜ëŠ” í‘œì¤€ê°’ì´ë¼ DBMS ë²¤ë”ì— ì˜ì¡´ì ì´ì§€ ì•ŠìŒ
        - 00###: ì •ìƒ ì²˜ë¦¬(ì—ëŸ¬ ì•„ë‹˜)
        - 01###: ê²½ê³  ë©”ì‹œì§€(Warning)
        - 02### : Not Found (selectë‚˜ cursor ì—ì„œ ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš°ë§Œ ì‚¬ìš©)
        - ë‚˜ë¨¸ì§€ : dbms ë³„ë¡œ í• ë‹¹ëœ ê°ìì˜ ì—ëŸ¬ ì¼€ì´ìŠ¤ ì˜ë¯¸
    - ERROR-MESSAGE : ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” í˜•íƒœì˜ ì—ëŸ¬ ë©”ì‹œì§€
- ì—ëŸ¬ ë©”ì‹œì§€ëŠ” ë˜‘ê°™ì€ë° ì—ëŸ¬ ë²ˆí˜¸ê°€ ë‹¤ë¥¸ ì‚¬í•­ í™•ì¸ í•„ìš”
â†’ ì—ëŸ¬ ë²ˆí˜¸ 1022, 1062, 1069 3ê°œ ì¡´ì¬í•˜ì§€ë§Œ sqlstate ê°’ì´ 23000 ìœ¼ë¡œ ë§¤í•‘
â†’ sqlstateë¥¼ í•¸ë“¤ëŸ¬ì— ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ
    
    
    | error no | sql state | error name | ì„¤ëª… |
    | --- | --- | --- | --- |
    | 1242 | 21000 | ER_SUBQUERY_NO_1_ROW | ë ˆì½”ë“œë¥¼ 1ê±´ë§Œ ë°˜í™˜í•´ì•¼ í•˜ëŠ” ì„œë¸Œì¿¼ë¦¬ì—ì„œ 1ê±´ ì´ìƒì˜ ë ˆì½”ë“œ ë°˜í™˜ |
    | 1406 | 22001 | ER_DATA_TOO_LONG | ì¹¼ëŸ¼ì— ì§€ì •ëœ í¬ê¸°ë³´ë‹¤ í° ê°’ì´ ì €ì¥ë˜ë©´ ë°œìƒí•˜ëŠ” ì—ëŸ¬ |
    | 1022 | 23000 | ER_DUP_KEY | í”„ë¼ì´ë¨¸ë¦¬ í‚¤ ë˜ëŠ” ìœ ë‹ˆí¬ í‚¤ ì¤‘ë³µ ì—ëŸ¬(NDB í´ëŸ¬ìŠ¤í„°) |
    | 1062 | 23000 | ER_DUP_ENTRY | í”„ë¼ì´ë¨¸ë¦¬ í‚¤ ë˜ëŠ” ìœ ë‹ˆí¬ í‚¤ ì¤‘ë³µ ì—ëŸ¬(InnoDB, MyISAM) |
    | 1169 | 23000 | ER_DUP_UNIQUE | ìœ ë‹ˆí¬ í‚¤ ì¤‘ë³µ ì—ëŸ¬(NDB í´ëŸ¬ìŠ¤í„°) |

**14.2.6.4.2 í•¸ë“¤ëŸ¬**

MySQL ì˜ ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì—ì„œ `DECLARE ... HANDLER` êµ¬ë¬¸ì„ ì´ìš©í•´ ì˜ˆì™¸ë¥¼ í•¸ë“¤ë§

```sql
DECLARE handler_type HANDLER
  FOR condition_value [, condition_value] ... handler statements 
```

- handler_type
    - `continue` : handler_statements ì‹¤í–‰ í›„ ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ë§ˆì§€ë§‰ ì‹¤í–‰ ì§€ì ìœ¼ë¡œ ëŒì•„ê°€ ë‚˜ë¨¸ì§€ ì½”ë“œ ì²˜ë¦¬
    - `exit` : ì •ì˜ëœ handler_statements ì‹¤í–‰ ë’¤ í•¸ë“¤ëŸ¬ê°€ ì •ì˜ëœ begin â€¦ end ë¸”ë¡ì„ ë²—ì–´ë‚¨
- condition_value
    - `sqlstate` : ì–´ë–¤ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ í•´ë‹¹ ì´ë²¤íŠ¸ì˜ sqlstate ê°’ì´ ì¼ì¹˜í•  ë•Œ ì‹¤í–‰ë˜ëŠ” í•¸ë“¤ëŸ¬ ì •ì˜
    - `sqlwarning` : í”„ë¡œê·¸ë¨ì—ì„œ ì½”ë“œ ì‹¤í–‰ ì¤‘ sql warning ë°œìƒí–ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¸ë“¤ëŸ¬ ì •ì˜
    - `not found` : select ì¿¼ë¦¬ ê²°ê³¼ ê±´ìˆ˜ê°€ 0ì´ê±°ë‚˜ cursor ë ˆì½”ë“œë¥¼ ë§ˆì§€ë§‰ê¹Œì§€ ì½ì€ ë’¤ì— ì‹¤í–‰í•˜ëŠ” í•¸ë“¤ëŸ¬ ì •ì˜
    - `sqlexception` : 00(ì •ìƒì²˜ë¦¬), 01(sql warning), 02(not found) ë¡œ ì‹œì‘í•˜ëŠ” sqlstate ì´ì™¸ì˜ ëª¨ë“  ì¼€ì´ìŠ¤ ì˜ë¯¸
    - mysql ì—ëŸ¬ ì½”ë“œ ê°’ì„ ì§ì ‘ ëª…ì‹œ
- ì˜ˆì‹œ

```sql
-- sqlexception ì´ ë°œìƒí–ˆì„ ë•Œ error_flag ë¡œì»¬ ë³€ìˆ˜ ê°’ì„ 1ë¡œ ì„¤ì • í›„ 
-- ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹¤í–‰í–ˆë˜ ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ëŒì•„ê°€ ê³„ì† ì‹¤í–‰í•˜ëŠ” í•¸ë“¤ëŸ¬
DECLARE continue HANDLER FOR sqlexception set error_flag = 1;

-- sqlexception ì´ ë°œìƒí–ˆì„ ë•Œ begin ... end ë¸”ë¡ ì‹¤í–‰ í›„ ì—ëŸ¬ ë°œìƒí•œ ì½”ë“œê°€ í¬í•¨ëœ ë¸”ë¡ì„ ë²—ì–´ë‚¨
DECLARE EXIT HANDLER FOR SQLEXCEPTION
  BEGIN 
    ROLLBACK;
    SELECT 'Error occurred - terminating';
  END ;;

-- ì—ëŸ¬ ë²ˆí˜¸ê°€ 1022, 1062 ì˜ˆì™¸ê°€ ë°œìƒí•œ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ë¡œ Duplicate key in index ë©”ì‹œì§€ ì¶œë ¥ í›„
-- ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì›ë¦¬ ì‹¤í–‰ ì§€ì ìœ¼ë¡œ ëŒì•„ê°€ì„œ ë‚˜ë¨¸ì§€ ì½”ë“œ ì‹¤í–‰
DECLARE CONTINUE HANDLER FOR 1022, 1062 SELECT 'Duplicate key in index';
-- SQLSTATE ê°’ì„ ëª…ì‹œí•˜ëŠ” ê²ƒì´ ì¢‹ìŒ. error no 1022, 1062 = sqlstate 23000
DECLARE CONTINUE HANDLER FOR SQLSTATE '23000' SELECT 'Duplicate key in index';

```

**14.2.6.4.3 ì»¨ë””ì…˜**

- `SQLWARNING`, `SQLEXCEPTION`, `NOT FOUND` ë“±ì€ MySQL ì„œë²„ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ë¯¸ë¦¬ ì •ì˜í•´ ë‘” ì»¨ë””ì…˜
- MySQL ì˜ í•¸ë“¤ëŸ¬ê°€ ì–´ë–¤ ì¡°ê±´ì´ ë°œìƒí–ˆì„ ë•Œ ì‹¤í–‰í• ì§€ë¥¼ ëª…ì‹œí•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜
- `DECLARE condition_name CONDITION FOR condition_value` ë¡œ ì •ì˜
    - `condition_name` : ì‚¬ìš©ìê°€ ë¶€ì—¬í•˜ë ¤ëŠ” ì´ë¦„ì„ ë‹¨ìˆœ ë¬¸ìì—´ë¡œ ì…ë ¥
    - `condition_value`
        - MySQL ì˜ ì—ëŸ¬ ë²ˆí˜¸ ì‚¬ìš© ì‹œ, ì—ëŸ¬ ë²ˆí˜¸ ì…ë ¥. ì—¬ëŸ¬ê°œ ë™ì‹œ ì…ë ¥ ë¶ˆê°€
        â†’ `DECLARE dup_key CONDITION FOR 1062;`
        - SQLSTATE ëª…ì‹œ í•˜ëŠ” ê²½ìš°, `SQLSTATE 21000` í˜•íƒœë¡œ ì…ë ¥

**14.2.6.4.4 ì»¨ë””ì…˜ì„ ì‚¬ìš©í•˜ëŠ” í•¸ë“¤ëŸ¬ ì •ì˜**

```sql
-- tb_test í…Œì´ë¸”ì€ í”„ë¼ì´ë¨¸ë¦¬ í‚¤ì¸ int í˜• ì¹¼ëŸ¼ 1ê°œë¥¼ ê°€ì§€ëŠ” table
-- 1ì´ë€ ê°’ì´ ì´ë¯¸ ì €ì¥ëœ ê²½ìš°, -1 ë¦¬í„´
-- 1 ê°’ ì—†ëŠ” ê²½ìš°, 1 ë¦¬í„´

mysql> CREATE FUNCTION sf_testfunc()
					RETURNS BIGINT
				BEGIN
						DECLARE dup_key CONDITION FOR 1062;
						DECLARE EXIT HANDLER FOR dup_key
							BEGIN 
								RETURN -1;
							END;;

						INSERT INTO tb_test VALUES (1);
						RETURN 1;
				END ;;
```

**14.2.6.4.5 ì‹œê·¸ë„ì„ ì´ìš©í•œ ì˜ˆì™¸ ë°œìƒ**

- MySQLì˜ ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì˜ˆì™¸ë‚˜ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ë ¤ë©´ `ì‹œê·¸ë„` ëª…ë ¹ì„ ì‚¬ìš©í•´ì•¼ í•¨
- `í•¸ë“¤ëŸ¬` ëŠ” catch êµ¬ë¬¸, `ì‹œê·¸ë„`ì€ thorw êµ¬ë¬¸ì— í•´ë‹¹í•˜ëŠ” ì •ë„
- SIGNAL ëª…ë ¹ì€ ì§ì ‘ SQLSTATE ê°’ì„ ê°€ì§€ê±°ë‚˜ ê°„ì ‘ì ìœ¼ë¡œ  SQLSTATEë¥¼ ê°€ì§€ëŠ” ì»¨ë””ì…˜ì„ ì°¸ì¡°í•´ì„œ ì—ëŸ¬ë‚˜ ê²½ê³  ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŒ
    - SIGNAL ì´ ë°œìƒì‹œí‚¨ SQLSTATE ê°’ì— ë”°ë¼ `00=ì •ìƒ`, `01=ì²˜ë¦¬ ì¤‘ ê²½ê³ `, `ê·¸ ë°–ì˜ ê°’=ì˜¤ë¥˜` êµ¬ë¶„

```sql
mysql> CREATE FUNCTION sf_divide (p_dividend int, p_divisor int)
					RETURNS int
				BEGIN
					DECLARE null_divisor CONDITION FOR SQLSTATE '45000';

					IF p_divisor IS NULL THEN
						SIGNAL null_divisor // SQLSTATEë¡œ ì»¨ë””ì…˜ì´ ì„¤ì •ë˜ì–´ì•¼ í•¨
							SET MESSAGE_TEXT='Divisor can not be null', MYSQL_ERRONO=9999;
					ELSEIF p_divisor=0 THEN
						SIGNAL SQLSTATE '45000'
							SET MESSAGE_TEXT='Divisor can not be 0', MYSQL_ERRONO=9998;

					// SIGNAL ëª…ë ¹ì€ ê²½ê³ , ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥
					// ê²½ê³  ë°œìƒ ì‹œí‚¨ ë’¤ 0 ë°˜í™˜
					ELSEIF p_dividend IS NULL THEN
						SIGNAL SQLSTATE '01000'
							SET MESSAGE_TEXT='Dividend is null, so regarding dividend as 0', MYSQL_ERRONO=9997;
						RETURN 0;
					END IF;;

					RETURN FLOOR(p_dividend / p_divisor);
				END;;	

mysql> select sf_divide(1, null);
mysql> select sf_divide(1,0);
mysql> select sf_divide(null, 1);

mysql> show warnings;

mysql> select sf_divide(0, 1);
```

**14.2.6.5.2 í•¸ë“¤ëŸ¬ ì½”ë“œì—ì„œ SIGNAL ì‚¬ìš©**

```sql
mysql> create procedure sp_remove_user (in p_userid int)
				begin 
					declare v_affectedrowcount int default 0;
					declare exit handler for sqlexception
						begin
								signal sqlstate '45000'
									set message_text='can not remove user information', MYSQL_ERRONO=9999;
							end;

					delete from tb_user where user_id=p_userid;
					// ìœ„ì—ì„œ ì‹¤í–‰ëœ delete ì¿¼ë¦¬ë¡œ ì‚­ì œëœ ë ˆì½”ë“œ ê±´ìˆ˜ í™•ì¸
					select row_count() into v_affectedrowcount ;
					if v_affectedrowcount <> 1 then
						signal sqlstate '45000';
					end if;
				end;;
```

### 14.2.6.6 ì»¤ì„œ

- ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì»¤ì„œëŠ” jdbc í”„ë¡œê·¸ë¨ì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ê²°ê³¼ ì…‹, php í”„ë¡œê·¸ë¨ì˜ mysql_query() í•¨ìˆ˜ë¡œ ë°˜í™˜ë˜ëŠ” ê²°ê³¼ì™€ ê°™ì€ ê²ƒ
    - ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì»¤ì„œëŠ” ì „ì§„ ë°©í–¥ ì½ê¸°ë§Œ ê°€ëŠ¥
    - ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì—ì„œëŠ” ì»¤ì„œì˜ ì¹¼ëŸ¼ì„ ë°”ë¡œ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì´ ë¶ˆê°€ëŠ¥
- DBMS ì˜ ì»¤ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ êµ¬ë¶„
    - `ì„¼ì„œí‹°ë¸Œ` ì»¤ì„œ: ì¼ì¹˜í•˜ëŠ” ë ˆì½”ë“œì— ëŒ€í•œ ì •ë³´ë¥¼ ì‹¤ì œ ë ˆì½”ë“œì˜ í¬ì¸í„°ë§Œìœ¼ë¡œ ìœ ì§€í•˜ëŠ” í˜•íƒœ
    - `ì¸ì„¼ì„œí‹°ë¸Œ` ì»¤ì„œ: ì¼ì¹˜í•˜ëŠ” ë ˆì½”ë“œë¥¼ ë³„ë„ì˜ ì„ì‹œ í…Œì´ë¸”ë¡œ ë³µì‚¬í•´ì„œ ê°€ì§€ê³  ìˆëŠ” í˜•íƒœ
    - `ì–´ì„¼ì„œí‹°ë¸Œ` ì»¤ì„œ: ì„¼ì„œí‹°ë¸Œì™€ ì¸ì„¼ì„œí‹°ë¸Œ ì»¤ì„œë¥¼ í˜¼ìš©í•´ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹. MySQL ì˜ ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì—ì„œ ì •ì˜ë˜ëŠ” ì»¤ì„œ
- declare ëª…ë ¹ìœ¼ë¡œ condition, handler, cursor ì •ì˜í•˜ëŠ”ë° ë¡œì»¬ ë³€ìˆ˜ì™€ condition > cursor > handler ìˆœìœ¼ë¡œ ì •ì˜í•´ì•¼ í•¨.
    
    ```sql
    mysql>
    create function sf_emp_count(p_dept_no varchar(10))
    	returns bigint
    begin
      // ë¡œì»¬ë³€ìˆ˜
    	declare v_total_count int default 0;
    	declare v_no_more_data tinyint default 0;
    	declare v_emp_no integer;
      declare v_from_date date;
    
      // ì»¤ì„œ
      declare v_emp_list cursor for select emp_no, from_date from dept_emp where dept_no=p_dept_no;
      // í•¸ë“¤ëŸ¬
      declare continue handler for not found set v_no_more_data=1;
    
      open v_emp_list;
      repeat
         fetch v_emp_list into v_emp_no, v_from_date;
         if v_emp_no > 20000 then
             set v_total_count = v_total_count + 1;
         end if;
      until v_no_more_date end repeat;
    
      close v_emp_list;
      return v_total_count;
    
    end;;
    ```
    

## 14.3 ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ë³´ì•ˆ ì˜µì…˜

- ~ MySQL 8.0 ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ìƒì„±/ë³€ê²½/ì‚­ì œ ê¶Œí•œ ê´€ë ¨í•´ì„œëŠ” `super` ì‚¬ìš©
- MySQL 8.0 ~ super ê¶Œí•œì„ ì˜¤ë¸Œì íŠ¸ë³„ ê¶Œí•œìœ¼ë¡œ ì„¸ë¶„í™”
    - ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ìƒì„±/ë³€ê²½ ê¶Œí•œì€ `create routine`, `alter routine`, `execute` ì‚¬ìš©
    - íŠ¸ë¦¬ê±° ê¶Œí•œ `trigger`, ì´ë²¤íŠ¸ ê¶Œí•œ `event` ì‚¬ìš©

 

### 14.3.1 DEFINER ì™€ SQL SECURITY ì˜µì…˜

ìŠ¤í† ì–´ë“œ í”„ê³ ê·¸ë¨ì„ ìƒì„±í•˜ê³  ì‹¤í–‰í•˜ëŠ” ê¶Œí•œì— DEFINER, SQL SECURITY ì‚¬ìš©

- DEFINER
    - ëª¨ë“  ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì´ ê¸°ë³¸ì ìœ¼ë¡œ ê°€ì§€ëŠ” ì˜µì…˜
    - í•´ë‹¹ ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì†Œìœ ê¶Œê³¼ ê°™ì€ ì˜ë¯¸ë¡œ ì‚¬ìš©
    - ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë  ë•Œì˜ ê¶Œí•œìœ¼ë¡œ ì‚¬ìš©
- SQL SECURITY
    - ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•  ë•Œ ëˆ„êµ¬ì˜ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í• ì§€ ê²°ì •í•˜ëŠ” ì˜µì…˜. definer, invoker ì˜µì…˜ ì„ íƒ
        - `definer` : ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì„ ìƒì„±í•œ ì‚¬ìš©ìë¥¼ ì˜ë¯¸
        - `invoker` : ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì„ í˜¸ì¶œí•œ ì‚¬ìš©ì ì˜ë¯¸
        
        ```
        -- definer user1@% ë¡œ ìƒì„±ëœ ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨
        -- user2@% ì‚¬ìš©ìê°€ ì‹¤í–‰í•œë‹¤ê³  ê°€ì •
        
        sql security=definer ì¸ ê²½ìš°,
        	ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ëŠ” ì‚¬ìš©ì ê³„ì • = user1@%
        	ì‹¤í–‰ì— í•„ìš”í•œ ê¶Œí•œ user1, ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ ë‚´ì—ì„œ ì‚¬ìš©í•˜ëŠ” sql ê´€ë ¨ í…Œì´ë¸”ì—ë„ ê¶Œí•œ í•„ìš”
        
        sql security=invoker ì¸ ê²½ìš°,
        	ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ëŠ” ì‚¬ìš©ì ê³„ì • = user2@%
        	ì‹¤í–‰ì— í•„ìš”í•œ ê¶Œí•œ user2, ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ ë‚´ì—ì„œ ì‚¬ìš©í•˜ëŠ” sql ê´€ë ¨ í…Œì´ë¸”ì—ë„ ê¶Œí•œ í•„ìš”
        ```
        
    - ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €, ìŠ¤í† ì–´ë“œ í•¨ìˆ˜, ë·°ë§Œ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ì˜µì…˜
    - ê¼­ í•„ìš”í•œ ìš©ë„ê°€ ì•„ë‹ˆë¼ë©´ `sql security=invoker` ì„¤ì •í•˜ëŠ”ê²ƒì´ ë³´ì•ˆì— ìœ ë¦¬
        
        

### 14.2.3 DETERMINISTIC ê³¼ NOT DETERMINISTIC ì˜µì…˜

ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì„±ëŠ¥ê³¼ ê´€ë ¨ëœ ì£¼ìš” ì˜µì…˜ì€ DETERMINISTIC, NOT DETERMINISTIC ìœ¼ë¡œ êµ¬ì„± ë¨. 
ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ëŠ” í•´ë‹¹ ì˜µì…˜ì˜ ì˜í–¥ì„ ê±°ì˜ ë°›ì§€ ì•Šê³ , ë°˜ë³µì ìœ¼ë¡œ í˜¸ì¶œë˜ëŠ” ìŠ¤í† ì–´ë“œ í•¨ìˆ˜ëŠ” ì˜í–¥ì„ ë§ì´ ë°›ì•„ ì¿¼ë¦¬ì˜ ì„±ëŠ¥ ì €í•˜ ìœ ë°œ ê°€ëŠ¥ì„±ì´ ìˆìŒ.

- `DETERMINISTIC` : ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì…ë ¥ì´ ê°™ë‹¤ë©´ ì‹œì ì´ë‚˜ ìƒí™©ì— ê´€ê³„ì—†ì´ ê²°ê³¼ê°€ í•­ìƒ ê°™ìŒ
- `NOT DETERMINISTIC` : ì…ë ¥ì´ ê°™ì•„ë„ ì‹œì ì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ë„ ìˆìŒì„ ì˜ë¯¸. `default`

```sql
mysql> create function sf_getdate1()
	returns datetime
	not deterministic
begin
	return now();
end ;;

mysql> create function sf_getdate2()
	returns datetime
	deterministic
begin
	return now();
end ;;

-- index full scan
mysql> explain select * from dept_emp where from_date > sf_getdate1();
--+-----------+--------+----------+----+------+--------+-----------+
id|select_type|table   |partitions|type|rows  |filtered|Extra      |
--+-----------+--------+----------+----+------+--------+-----------+
 1|SIMPLE     |dept_emp|          |ALL |331143|   33.33|Using where|

-- index range scan ê°€ëŠ¥
mysql> explain select * from dept_emp where from_date > sf_getdate2();
--+-----------+--------+----------+-----+-------------+-----------+
id|select_type|table   |partitions|type |possible_keys|Extra      |
--+-----------+--------+----------+-----+-------------+-----------+
 1|SIMPLE     |dept_emp|          |range|ix_fromdate  |Using where|
```

## 14.4 ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì°¸ê³  ë° ì£¼ì˜ì‚¬í•­

### 14.4.1 í•œê¸€ì²˜ë¦¬

ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì˜ ì†ŒìŠ¤ ì½”ë“œì— í•œê¸€ ë¬¸ìì—´ ê°’ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë¨ì´ ì–´ë–¤ ë¬¸ì ì§‘í•©ìœ¼ë¡œ MySQL ì„œë²„ì— ì ‘ì†ë¼ ìˆëŠ”ì§€ê°€ ì¤‘ìš”

- `character_set_client`, `character_set_connection` ì„¸ì…˜ ë³€ìˆ˜ê°€ ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì„ ìƒì„±í•˜ëŠ”ë° ê´€ì—¬í•˜ëŠ” ë¶€ë¶„
- ê¸°ë³¸ê°’ì€ `latin1` ì´ë‚˜ í•œê¸€ì— ì í•©í•œ ë¬¸ì ì§‘í•© ì•„ë‹˜. `utf8mb4` ë¡œ ë³€ê²½ í•„ìš”

```sql
mysql> show variables like 'character%';

------------------------+------------------------------+
Variable_name           |Value                         |
------------------------+------------------------------+
character_set_client    |utf8mb4                       |
character_set_connection|utf8mb4                       |
character_set_database  |utf8mb4                       |
character_set_filesystem|binary                        |
character_set_results   |                              |
character_set_server    |utf8mb4                       |
character_set_system    |utf8mb3                       |
character_sets_dir      |/usr/share/mysql-8.0/charsets/|

mysql> set character_set_client = 'utf8mb4';
mysql> set character_set_connection = 'utf8mb4';

-- í•œêº¼ë²ˆì— ì„¤ì • ê°€ëŠ¥í•˜ì§€ë§Œ, ì¬ì ‘ì† ì‹œ ì´ˆê¸°í™”ë˜ë¯€ë¡œ charset utf8mb4 ëª…ë ¹ ì‚¬ìš© ì¶”ì²œ
mysql> set NAMES 'utf8mb4';
```

## 14.4.2 ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ê³¼ ì„¸ì…˜ ë³€ìˆ˜

- ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ì—ì„œ
    - `declare` ëª…ë ¹ìœ¼ë¡œ ë¡œì»¬ ë³€ìˆ˜ ì§€ì •
    - `@` ë¡œ ì‹œì‘í•˜ëŠ” ì‚¬ìš©ì ë³€ìˆ˜ ì§€ì • ê°€ëŠ¥
    - ì‚¬ìš©ì ë³€ìˆ˜ëŠ” íƒ€ì… ë¯¸ì§€ì •ìœ¼ë¡œ ì˜í–¥ ë²”ìœ„ê°€ ë¡œì»¬ ë³€ìˆ˜ë³´ë‹¤ ë„“ê¸° ë•Œë¬¸ì— ì˜ë„í•˜ì§€ ì•Šê²Œ ì˜í–¥ë„ê°€ ì»¤ì§ˆ ìˆ˜ ìˆìŒ
- ê°€ëŠ¥í•œ í•œ ë¡œì»¬ ë³€ìˆ˜ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ

```sql
mysql> ...
declare v_sum int default 0;
set v_sum=p_arg1 + p_arg2;
set @v_sum=v_sum;
...
```

## 14.4.3 ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ì™€ ì¬ê·€ í˜¸ì¶œ

- ìŠ¤í† ì–´ë“œ í”„ë¡œê·¸ë¨ ì¤‘ ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ì—ì„œë§Œ  `ì¬ê·€ í˜¸ì¶œ` ì‚¬ìš© ê°€ëŠ¥
- `max_sp_recursion_depth` ì‹œìŠ¤í…œ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•´ ìµœëŒ€ ì¬ê·€ í˜¸ì¶œ ìˆ˜ ì„¤ì • ê°€ëŠ¥. ê¸°ë³¸ 0
- ì¬ê·€ í˜¸ì¶œ ì‹¤í–‰ ì¤‘ MySQLì„œë²„ì—ì„œ í• ë‹¹í•œ ìŠ¤íƒì˜ ë©”ëª¨ë¦¬ê°€ ì†Œëª¨ë¼ ë²„ë¦¬ë©´ ì—ëŸ¬ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì¢…ë£Œ ë¨
- p350 ì˜ˆì œ ì‹¤í–‰í•˜ì‹  ë¶„..?

### 14.4.4 ì¤‘ì²©ëœ ì»¤ì„œ ì‚¬ìš©

- ì¼ë°˜ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ì»¤ì„œ ì‚¬ìš©ì´ ëë‚˜ë©´ ë‹«ê³  ë‹¤ì‹œ ìƒˆë¡œìš´ ì»¤ì„œ ì˜¤í”ˆ
- ì¤‘ì²©ëœ ë£¨í”„ ì•ˆì—ì„œ ë‘ ê°œì˜ ì»¤ì„œ ë™ì‹œ ì˜¤í”ˆ ì‚¬ìš© ê°€ëŠ¥
    - ë°˜ë³µ ë£¨í”„ê°€ ì—¬ëŸ¬ë²ˆ ì‚¬ìš©ë  ë•ŒëŠ” ë£¨í”„ë¥¼ ì„œë¡œ ë‹¤ë¥¸ begin â€¦ end ë¸”ë¡ìœ¼ë¡œ êµ¬ë¶„í•´ì„œ ì‘ì„±