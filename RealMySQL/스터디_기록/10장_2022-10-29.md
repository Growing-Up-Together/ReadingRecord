# ✏️ 스터디 기록

- 스터디 일시 : 2022.10.29
- 서기: winnie

<br />

## 10장. 실행계획

### 학습 내용

- key 칼럼에 표시되는 인덱스는 최종 선택된 실행 계획에서 사용하는 인덱스를 의미한다.
- key_len 칼럼의 값은 다중 칼럼으로 구성된 인덱스에서 몇 개의 칼럼까지 사용했는지 알려준다.
- 접근 방법이 ref면 참조 조건으로 어떤 값이 제공됐는지 보여준다.
- rows 칼럼값은 실행 계획의 효율성 판단을 위해 예측했던 레코드 건수를 보여준다.
- filtered 칼럼은 필터링되고 남은 레코드의 비율이다.
- Extra 칼럼은 성능에 관련된 중요 내용이 있다.
    - FirstMatch에 세미 조인을 최적화한 테이블이 표시된다.
    - 서브 쿼리가 1건도 결과 레코드를 가지지 않으면 테이블 풀 스캔이 일어난다.
    - "Impossible ..." 이면 해당 쿼리에 사용된 어떤 조건을 만족하는 레코드가 없을 때 표시된다.
    - 다른 커넥션에서 실행 중인 쿼리의 실행 계획을 살펴볼 수 있는데, Plan ins't ready yet이면 실행 계획을 아직 수립하지 못한 상태이다.
    - 레코트다마 인덱스 레인지 스캔을 체크할 때 "Range checked for each record"가 표시된다.
    - 재귀 쿼리를 작성한 경우 "Recursive"가 표시된다.
    - min/max 사용시 오름차순 또는 내림차순으로 1건만 읽으므로 "Select tables optimized away"가 표시된다.
    - ORDER BY에서 인덱스를 사용하지 못할 때 "Using filesort"가 표시된다 → 성능 튜닝이 필요!
    - "Using index"가 표시되면 커버링 인덱스를 의미한다.
    - InnoDB는 테이블의 모든 세컨더리 인덱스는 데이터 레코드의 주솟값으로 프라이머리 키를 가진다.
    - 컨디션 푸시 다운 최적화 사용시 "Using index condition"이 표시된다.
    - GROUP BY 처리에 인덱스가 사용되면 인덱스의 필요한 부분만 읽기 때문에 빠르게 처리된다.
    - GROUP BY는 타이트 인덱스 스캔과 루스 인덱스 스캔으로 나뉜다. → 루스 인덱스 스캔을 타는 것이 좋다.
    - GROUP BY에서 다중 칼럼으로 만들어진 인덱스의 경우에는 인덱스 사용 조건을 만족하도록 해야 한다.
    - GROUP BY에서 인덱스를 사용하기 위해 WHERE 절에서 사용하는 인덱스도 영향을 받는다.
    - 조인에 필요한 인덱스는 뒤에 읽는 테이블의 칼럼에만 필요하다. → 드리븐 테이블은 인덱스가 있는 테이블로 잡게 된다.
    - 조인 버퍼가 사용되는 조인의 경우 "Using join buffer..."가 표시된다.
    - "Using temporary" 가 표시되면 임시 테이블이 사용된 것이다.
    - MySQL 엔진 레이어에서 별도의 가공으로 필터링 작업을 처리한 경우만 "Using where"로 표시된다.
    - 쿼리 결괏값에 메타데이터만 필요한 경우 "Zero limit"가 표시된다.

### 질문

- `p.484` 조인 버퍼가 모든 조인에 사용되나? 조인 결과가 여러 건이면 대부분 조인 버퍼를 이용하지 않을까? hash join과 BKA가 다르게 처리되나? 
    - 조인 버퍼가 사용되는 조인은 Block Nested Loop, Batched Key Access, hash join 이다.
    - Block Nested Loop는 hash join으로 대체되었다.
    - MRR과 리드 어헤드(`p.446`)를 구분해서 이해하자.
    - BKA 조인 최적화는 부가적인 정렬 작업이 필요해지면 오히려 성능에 안좋은 영향을 미쳐서 기본적으로 비활성화 되어 있다.
    - `p.321` 네스티드 루프 조인과 블록 네스티드 루프 조인의 가장 큰 차이는 조인 버퍼가 사용되는지 여부다. → 조인할 때 항상 조인 버퍼가 사용되는 건 아니다. 
    - `p.321` 실행 계획에서 "Using Join buffer"라는 문구가 표시되면 조인버퍼를 사용하는 것이다.
    - `p.322` 조인할 때 사용되는 메모리의 캐시를 조인버퍼라고 한다.
- `p.470` CTE 테이블이 MySQL에서 미리 설정된 예약어 같은 것이지?
    - 아니다. 테이블명을 변경해도 재귀 쿼리 사용 가능하다.
- `p.469` 인덱스의 순번을 계산하기 위한 변환 방법이 헷갈린다.
    - index map:N N이 인덱스의 순번인데 16진수로 표시된다.

## 다음주 공지

✔️ 오프라인 만남 : 11/12(토) 점심 시간 쯤 태조감자국!!
✔️ 만나는 날에 스터디 방식 생각해오기~

<br>

# ⏳ 1권 마지막 회고

## 좋았던 점
- 혼자서는 절대 읽을 수 없었을텐데, 같이 읽어서 끝까지 마칠 수 있어서 참 다행이다.
- 책 한권을 끝냈다 ^~^
- 2권을 포기하고 싶었지만 모두 같이 2권까지 하게 되어서 좋다!
- 공부하는 습관이 생겼다.
- 예전에는 모르는 부분을 그냥 넘겼는데, 이제는 제대로 알아보기 위해 공부하게 된다. 

## 아쉬웠던 점
- 마지막에 지각을 해버렸다.
- 많은 개념을 배워서 머리속에서 헷갈린다.

## 액션 플랜
- 1권에서 헷갈린 내용을 2권에서 정리하면서 머리속에 다 정리하자!!
- 공부하는 습관에 대해 회고도 같이 해보자. 
- 코로나가 좀 풀렸으니 오프라인으로 스터디도 해보고 싶다.